@page "/submissions/department-case-feedback-scores/{periodName}/submit"
@model Metrics.Web.Pages.Submissions.DepartmentCaseFeedbackScores.SubmitModel
@{
    ViewData["Title"] = "New Department Case Feedback";
}


<div class="sectionTitle">
    <h4>Submit Department Case Feedback <strong>(@Model.SelectedPeriod?.PeriodName)</strong></h4>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-page="/Index">Home</a></li>
            <li class="breadcrumb-item"><a asp-page="/Submissions/Index">Submissions</a></li>
            <li class="breadcrumb-item"><a asp-page="/Submissions/DepartmentCaseFeedbackScores/Index">Department Case Feedbacks</a></li>
            <li class="breadcrumb-item active">Submit</li>
        </ol>
    </nav>
</div>

<div class="container">
    <div class="my-4 pb-4">
        @* <div class="filter-toolbar mb-4 d-flex justify-content-between"><span class="d-flex align-items-center gap-2"></span><div></div></div> *@
        
        @if (!ModelState.IsValid) 
        {
            <div class="alert alert-danger">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            </div>
        }

        @* RENDER THE FORM *@
        @if (ModelState.IsValid)  
        {
            <section class="form">
                <form method="post">
                @* 
                    submitted at
                    case department | submitter(person who give feedback)
                    -------------------
                    incident at
                    ward name       | cpi number
                    patient name    | room number
                    -------------------
                    description
                *@
                    @if(Model.Feedbacks.Any() && Model.Feedbacks.Count > 0)
                    {
                        <input type="hidden" asp-for="@Model.SelectedPeriodName" />
                        <div class="actionButtons row mb-3">
                            <div class="form-group col-md d-flex justify-content-end align-items-center gap-2">
                                <button type="button" class="btn btn-warning me-2" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#cancelDialogstaticBackdrop">
                                    <i class="bi bi-x-circle"> </i>Cancel</button>
                                <button type="button" class="btn btn-primary me-2" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#submitDialogBackdrop">
                                    <i class="bi bi-check-circle"> </i>Submit</button>
                            </div>
                        </div>

                        @for(int i=0; i<Model.Feedbacks.Count; i++)
                        {
                            <div class="feedback-item mb-3 px-3 py-4">
                                <div class="feedback-item-header row g-3 align-items-center rounded-top mb-3 px-4 ">
                                    <div class="col-xs-12 col-sm-6 col-md-auto me-4">
                                        @* ID: 
                                        Lookup ID: <input type="text" asp-for="FormInput[i].LookupId" value="@Model.FormInput[i].LookupId" />
                                        submit at<input type="text" asp-for="FormInput[i].SubmittedAt" value="@Model.FormInput[i].SubmittedAt" /> *@
                                        @* <strong>(@Model.Feedbacks[i].Id)</strong> *@
                                        <input type="text" asp-for="FormInput[i].Id" value="@Model.FormInput[i].Id" />
                                        <input type="hidden" asp-for="FormInput[i].FeedbackId" value="@Model.Feedbacks[i].Id" />
                                        <label class="form-label">Case Department: </label>
                                        <strong>@Model.Feedbacks[i].CaseDepartment?.DepartmentName</strong>
                                    </div>
                                    <div class="col-xs-12 col-sm-6">
                                        <label class="form-label">Incident At: </label>
                                        <strong>@Model.Feedbacks[i].IncidentAt.ToString("dd/MMM/yyyy hh:mm tt")</strong>
                                    </div>
                                </div>

                                <div class="row g-3 align-items-center mb-3 bg-light border-start border-end">
                                    <div class="col-auto me-4">
                                        <label class="form-label">Ward Name : </label>
                                            <strong>@Model.Feedbacks[i].WardName</strong>
                                    </div>
                                    <div class="col-auto me-4">
                                        <label class="form-label">CPI Number: </label>
                                            <strong>@Model.Feedbacks[i].CPINumber</strong>
                                    </div>
                                    <div class="col-auto me-4">
                                        <label class="form-label">Patient Name:</label>
                                            <strong>@Model.Feedbacks[i].PatientName</strong>
                                    </div>
                                    <div class="col-auto me-4">
                                        <label class="form-label">Room Number</label>
                                            <strong>@Model.Feedbacks[i].RoomNumber</strong>
                                    </div>
                                    <div class="col-auto mb-2">
                                        <label class="form-label me-2">Description:</label>
                                            <strong>@Model.Feedbacks[i].Description</strong>
                                    </div>
                                </div>

                                <div class="row g-3 align-items-center mb-3 bg-light border border-1">
                                    <div class="col-auto me-4">
                                        <label class="form-label">Feedback By: </label>
                                        <strong>@Model.Feedbacks[i].FeedbackSubmitter.FullName (@Model.Feedbacks[i].FeedbackSubmitter.Department.DepartmentName)</strong>
                                    </div>
                                    <div class="col-auto me-4">
                                        <label class="form-label">At:</label>
                                        <strong>@Model.Feedbacks[i].SubmittedAt.ToString("dd/MMM/yyyy hh:mm tt")</strong>
                                    </div>
                                    @* <div class="col-auto me-4">
                                        <label class="form-label">Edited At:</label>
                                        <strong>@Model.Feedbacks[i].SubmittedAt.ToString("dd / MMMM / yyyy hh:mm tt")</strong>
                                    </div> *@
                                </div>

                                <div class="row g-3 px-4 align-items-center mb-3 bg-light border-start border-end">
                                    <div class="col-xs-12  col-sm-2 col-md-2 col-lg-1 col-form-label me-4">
                                        <label class="form-label">Rate:</label>
                                    </div>
                                    <div class="col me-4">
                                        <div class="radio__scoreValue ps-0 form-check form-check-inline d-flex flex-wrap gap-2">
                                            @for(int x=0; x<Model.ScoreList.Length; x++)
                                            {
                                                var radioId = $"radio_{i}_{x}";
                                                <label for="@radioId" 
                                                        class="radioLabel__score 
                                                                form-check-label
                                                                rounded-3 
                                                                ps-4 pe-4">
                                                    <input class="radioInput__score"
                                                            type="radio" 
                                                            asp-for="FormInput[i].ScoreValue" 
                                                            value="@Model.ScoreList[x]"
                                                            checked="@(Model.FormInput[i].ScoreValue.ToString("0.00") == Model.ScoreList[x].ToString("0.00"))"
                                                            id="@radioId" />
                                                    <strong>@Model.ScoreList[x]</strong>
                                                </label>
                                            }
                                        </div>
                                        <div>
                                            <span asp-validation-for="FormInput[i].ScoreValue" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 px-4 bg-light border-start border-end">
                                    <div class="col-xs-12 col-sm-2 col-md-2 col-lg-1 col-form-label me-4">
                                        <label class="form-label">Comments:</label>
                                    </div>
                                    <div class="col me-4">
                                        <div class="w-100">
                                            <textarea asp-for="FormInput[i].Comments" 
                                                    class="form-control mb-3" 
                                                    rows="5"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="row text-danger pb-3 text-end g-3 px-4 bg-light border-start border-end border-bottom rounded-bottom">
                                    @* <div class="col-xs-12  col-sm-2 col-md-2 col-lg-1 me-4">
                                        <label class="form-label">Edit:</label>
                                    </div> *@
                                    <div class="col me-4">
                                        @if(Model.FormInput[i].ModifiedAt.LocalDateTime.Year != 0001)
                                        {
                                            <div>
                                                <text class="form-label mb-3">Updated: <small>@Model.FormInput[i].ModifiedAt.LocalDateTime.ToString("dd/MMM/yyyy hh:mm tt")</small>
                                                </text>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    }  


                    @* =========== MODAL =========== *@
                    @* ---------- CANCEL DIALOG ---------- *@
                    <div class="modal fade" id="cancelDialogstaticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="cancelDialogStaticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="cancelDialogStaticBackdropLabel">Cancel</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to cancel the submission?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" 
                                            class="btn btn-secondary"
                                            data-bs-dismiss="modal">
                                        <i class="bi bi-x-circle"> </i>No</button>

                                        <button asp-page-handler="Cancel" type="submit" 
                                                class="btn btn-primary ms-2" formnovalidate>
                                            <i class="bi bi-check-circle"> </i>Yes</button>

                                </div>
                            </div>
                        </div>
                    </div>

                    @* ---------- SUBMIT DIALOG ---------- *@
                    <div class="modal fade" id="submitDialogBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="submitDialogStaticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="submitDialogStaticBackdropLabel">Confirmation</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to submit the form?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" 
                                            class="btn btn-secondary"
                                            data-bs-dismiss="modal">
                                        <i class="bi bi-x-circle"> </i>No</button>
                                    <button type="submit"
                                            class="btn btn-primary me-2">
                                        <i class="bi bi-check-circle"> </i>Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </section>
        }
    </div>
</div>

@section Styles {
    @* <link rel="stylesheet" href="~/lib/tempus-dominus-6.10.4/dist/css/tempus-dominus.min.css" /> *@
    <style>

        .feedback-item-header {
            color: var(--light-color);
            background: var(--metric-red-color);
        }
        @* .feedback-item .btn {
            background: var(--metric-red-color);
            border: 0;
        }
        .feedback-item .card-body .btn:hover {
            background: var(--metric-deepred-color);
            border: 0;
        } *@


        .radio__scoreValue {
        }

        .radioLabel__score {
            margin-right: 1.2em;
        }

        .radioInput__score {
            transform: scale(1.5);
            margin-right: .4em;
        }

        .radioLabel__score, .radioInput__score {
            cursor: pointer;
            font-size: 1.2em;
            @* transform: scale(1.1); *@
        }

        .radioLabel__score {
            padding: 0.5rem;  /* Clickable area padding */
            transition: background-color 0.2s;  
            border: .1em solid #ffffff00; 
            @* border: .1em solid #3c9aff; *@

        }
        .radioLabel__score:hover {
            border: .1em solid var(--metric-red-color);
            @* background: #0072b4; *@
        }

        /* Align radio and text */
        .radioLabel__score .radioInput__score-check-input {
            margin-top: 0;
        }

        .radioLabel__score:has(.radioInput__score:checked) {
            border: .1em solid var(--metric-red-color);
            @* border: .2em solid #007bff; *@
            @* background: #0072b4; *@
        }

        #incidentAt__datetimePicker input {
            text-transform: uppercase;
        }

    </style>
}


@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    @* <script src="~/lib/popperjs-2.11.8/dist/umd/popper.min.js"></script>

    <script type="module">
        import { TempusDominus } from "/lib/tempus-dominus-6.10.4/dist/js/tempus-dominus.esm.min.js";
        var el = document.getElementById('incidentAt__datetimePicker');
        document.addEventListener("DOMContentLoaded", function() {
            new TempusDominus(el, {
                restrictions: {
                    maxDate: new Date(), // Disable future dates
                },
                localization: {
                    format: 'dd / MMMM / yyyy hh:mm t', // Correct option for v6+
                    hourCycle: 'h12' // Explicit 12-hour cycle
                },
                display: { 
                    sideBySide: true,
                    theme: 'light', // or 'dark'
                    icons: {
                        time: 'bi bi-clock-fill',         // Clock icon
                        date: 'bi bi-calendar2-week-fill',       // Calendar icon
                        up: 'bi bi-chevron-up',       // Up arrow
                        down: 'bi bi-chevron-down',   // Down arrow
                        previous: 'bi bi-chevron-left',  // Previous
                        next: 'bi bi-chevron-right',     // Next
                        today: 'bi bi-calendar-check',   // Today
                        clear: 'bi bi-trash',            // Clear
                        close: 'bi bi-x-lg'               // Close
                    } 
                }     
            });
        }); 
    </script>
    *@

  

    
}